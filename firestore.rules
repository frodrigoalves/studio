rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Regra geral: Admins autenticados podem fazer tudo.
    match /{document=**} {
      allow read, write: if request.auth != null;
    }

    // Regra para a coleção 'tripRecords'
    match /tripRecords/{tripId} {
      // Permite que qualquer pessoa crie um novo registro (iniciar viagem).
      allow create: if true;
      // Permite que qualquer pessoa leia um *único* documento.
      // Isso é necessário para a função "Finalizar Viagem", que busca um registro em andamento.
      allow get: if true;
      // Atualizar e deletar continua restrito a admins pela regra geral.
    }

    // Regra para a coleção 'checklistRecords'
    match /checklistRecords/{checklistId} {
      // Permite que qualquer pessoa crie um novo registro de vistoria.
      allow create: if true;
    }
    
    // Regra para a coleção 'fuelingRecords'
    match /fuelingRecords/{fuelingId} {
      // Permite que qualquer pessoa crie um novo registro de abastecimento.
      allow create: if true;
    }

    // Regra para outras coleções (configurações, etc.)
    // Elas serão cobertas pela regra geral, exigindo autenticação.
    match /dieselPrices/{priceId} {
        allow read, write: if request.auth != null;
    }
    
    match /vehicleParameters/{vehicleId} {
        allow read, write: if request.auth != null;
    }

     match /maintenanceRecords/{maintId} {
        allow read, write: if request.auth != null;
    }
  }
}
